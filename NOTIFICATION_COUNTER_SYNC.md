# üîî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞**

### ‚ùå **–ë–´–õ–û:**
–°—á–µ—Ç—á–∏–∫ –≤ —Ö–µ–¥–µ—Ä–µ –∏ —Å—á–µ—Ç—á–∏–∫–∏ –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–ª–∏ –ø–æ —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–µ:
- **–•–µ–¥–µ—Ä**: —Å—á–∏—Ç–∞–ª –í–°–ï –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤**: —Å—á–∏—Ç–∞–ª —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–Ω—Ü–∞

### ‚úÖ **–°–¢–ê–õ–û:**
–¢–µ–ø–µ—Ä—å –æ–±–∞ —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ª–æ–≥–∏–∫—É**:
- –°—á–∏—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ** —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–æ–Ω—Ü–∞ –¥–∏–∞–ª–æ–≥–∞
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API `/api/notifications/stats`:

```typescript
// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
const baseConversations = await prisma.$queryRaw`
  SELECT DISTINCT c.id as client_id
  FROM clients c
  JOIN feedback f ON c.id = f.client_id
`;

// –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å—á–∏—Ç–∞–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
let totalNotifications = 0;
for (const conv of baseConversations) {
  const recentMessages = await prisma.feedback.findMany({
    where: { clientId: conv.client_id },
    orderBy: { createdAt: 'desc' },
    take: 50,
    select: { senderRole: true }
  });

  // –°—á–∏—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–æ–Ω—Ü–∞
  let unreadCount = 0;
  for (const message of recentMessages) {
    if (message.senderRole === 'user') {
      unreadCount++;
    } else {
      break; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∞
    }
  }
  
  totalNotifications += unreadCount;
}
```

### –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
- **Header.tsx** - —Å—á–µ—Ç—á–∏–∫ —Ä—è–¥–æ–º —Å –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–æ–º
- **NotificationsPage** - —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ —Å—á–µ—Ç—á–∏–∫–∞–º–∏

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:
```
–î–∏–∞–ª–æ–≥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º –ò–≤–∞–Ω–æ–º:
1. üèãÔ∏è –ò–≤–∞–Ω: "–í–æ–ø—Ä–æ—Å 1"
2. üë§ –ê–¥–º–∏–Ω: "–û—Ç–≤–µ—Ç 1"  
3. üèãÔ∏è –ò–≤–∞–Ω: "–í–æ–ø—Ä–æ—Å 2"
4. üèãÔ∏è –ò–≤–∞–Ω: "–í–æ–ø—Ä–æ—Å 3"

–°—á–µ—Ç—á–∏–∫ –≤ —Ö–µ–¥–µ—Ä–µ: 2 (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —Å–æ–æ–±—â–µ–Ω–∏—è)
–°—á–µ—Ç—á–∏–∫ –≤ —Å–ø–∏—Å–∫–µ: 2 (—Ç–µ –∂–µ 2 —Å–æ–æ–±—â–µ–Ω–∏—è)
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –æ–±–∞ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ **–õ–æ–≥–∏—á–Ω–æ—Å—Ç—å** - –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ 50 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –∞–Ω–∞–ª–∏–∑
- ‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å** - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

## üì± **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**

### –í —Ö–µ–¥–µ—Ä–µ:
```
üîî [5] ‚Üê –°—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
```

### –í —Å–ø–∏—Å–∫–µ –¥–∏–∞–ª–æ–≥–æ–≤:
```
üìû –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤     üî¥ 2
üìû –ú–∞—Ä–∏—è –ö–æ–∑–ª–æ–≤–∞   üî¥ 1  
üìû –ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤    ‚ö™ 0
```

**–ò—Ç–æ–≥–æ –≤ —Ö–µ–¥–µ—Ä–µ: 5 = 2 + 1 + 0 + (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã)**

## ‚ö° **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**

### –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- **–•–µ–¥–µ—Ä**: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (—Ç–∏—Ö–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- **–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤**: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (—Ç–∏—Ö–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- **–ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –±–µ–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–Ω–µ–∑–∞–º–µ—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üì± –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –±–æ—Ç
     ‚Üì
üíæ –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
     ‚Üì
‚è∞ –ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–º–∞–∫—Å) —Å—á–µ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è:
   üîî –•–µ–¥–µ—Ä: +1
   üìã –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤: +1 –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:
```typescript
// –í —Ö–µ–¥–µ—Ä–µ:
const interval = setInterval(silentFetchNotifications, 5000);

// –í —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤:
const interval = setInterval(() => {
  fetch('/api/notifications/conversations')
    .then(data => setConversations(data.conversations))
}, 5000);
```

–¢–µ–ø–µ—Ä—å —Å—á–µ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**! üéâ
